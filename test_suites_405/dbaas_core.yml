test_kind: js_test

selector:
  roots:
  - jstests/core/**/*.js
  - jstests/core_standalone/**/*.js
  exclude_files:
  # Transactions are not supported on MongoDB standalone nodes, so we do not run these tests in the
  # 'core' suite. Instead we run them against a 1-node replica set in the 'core_txns' suite.
  - jstests/core/txns/**/*.js
  - jstests/core/auth1.js
  - jstests/core/auth_copydb.js
  - jstests/core/automation_setparameter.js
  - jstests/core/awaitdata_getmore_cmd.js
  - jstests/core/bench_test1.js
  - jstests/core/bench_test2.js
  - jstests/core/bench_test3.js
  - jstests/core/bypass_doc_validation.js
  - jstests/core/cannot_create_system_dot_indexes.js
  - jstests/core/capped6.js
  - jstests/core/capped_empty.js
  - jstests/core/capped_update.js
  - jstests/core/collation.js
  - jstests/core/collection_truncate.js
  - jstests/core/commands_namespace_parsing.js
  - jstests/core/commands_with_uuid.js
  - jstests/core/compact_keeps_indexes.js
  - jstests/core/connection_status.js
  - jstests/core/connection_string_validation.js
  - jstests/core/constructors.js
  - jstests/core/count10.js
  - jstests/core/count_plan_summary.js
  - jstests/core/create_indexes.js
  - jstests/core/currentop.js
  - jstests/core/cursora.js
  - jstests/core/dbadmin.js
  - jstests/core/dbhash2.js
  - jstests/core/distinct3.js
  - jstests/core/dropdb_race.js
  - jstests/core/elemmatch_or_pushdown.js
  - jstests/core/eval0.js
  - jstests/core/eval1.js
  - jstests/core/eval3.js
  - jstests/core/eval4.js
  - jstests/core/eval5.js
  - jstests/core/eval6.js
  - jstests/core/eval7.js
  - jstests/core/eval9.js
  - jstests/core/eval_mr.js
  - jstests/core/eval_nolock.js
  - jstests/core/evala.js
  - jstests/core/evalb.js
  - jstests/core/evald.js
  - jstests/core/evale.js
  - jstests/core/evalg.js
  - jstests/core/evalh.js
  - jstests/core/evalj.js
  - jstests/core/exhaust.js
  - jstests/core/explain_shell_helpers.js
  - jstests/core/find_and_modify_concurrent_update.js
  - jstests/core/fsync.js
  - jstests/core/geo_update_btree.js
  - jstests/core/geo_update_btree2.js
  - jstests/core/index9.js
  - jstests/core/index_bigkeys_nofail.js
  - jstests/core/index_bigkeys_validation.js
  - jstests/core/index_id_options.js
  - jstests/core/insert2.js
  - jstests/core/ismaster.js
  - jstests/core/js3.js
  - jstests/core/js7.js
  - jstests/core/js9.js
  - jstests/core/json_schema/misc_validation.js
  - jstests/core/killop_drop_collection.js
  - jstests/core/list_all_local_cursors.js
  - jstests/core/list_all_local_sessions.js
  - jstests/core/list_all_sessions.js
  - jstests/core/list_collections_no_views.js
  - jstests/core/list_indexes.js
  - jstests/core/list_sessions.js
  - jstests/core/loadserverscripts.js
  - jstests/core/logprocessdetails.js
  - jstests/core/max_time_ms.js
  - jstests/core/mr_killop.js
  - jstests/core/notablescan.js
  - jstests/core/opcounters_write_cmd.js
  - jstests/core/profile1.js
  - jstests/core/profile3.js
  - jstests/core/queryoptimizer3.js
  - jstests/core/queryoptimizera.js
  - jstests/core/read_after_optime.js
  - jstests/core/recursion.js
  - jstests/core/remove8.js
  - jstests/core/remove9.js
  - jstests/core/removeb.js
  - jstests/core/removec.js
  - jstests/core/rename8.js
  - jstests/core/restart_catalog.js
  - jstests/core/role_management_helpers.js
  - jstests/core/set_param1.js
  - jstests/core/shell_connection_strings.js
  - jstests/core/shellstartparallel.js
  - jstests/core/splitvector.js
  - jstests/core/stages_and_hash.js
  - jstests/core/stages_and_sorted.js
  - jstests/core/stages_collection_scan.js
  - jstests/core/stages_delete.js
  - jstests/core/stages_fetch.js
  - jstests/core/stages_ixscan.js
  - jstests/core/stages_limit_skip.js
  - jstests/core/stages_mergesort.js
  - jstests/core/stages_or.js
  - jstests/core/stages_text.js
  - jstests/core/storefunc.js
  - jstests/core/updatef.js
  - jstests/core/user_management_helpers.js
  - jstests/core/validate_cmd_ns.js
  - jstests/core/validate_user_documents.js
  - jstests/core/views/duplicate_ns.js
  - jstests/core/views/views_all_commands.js
  - jstests/core/views/views_change.js
  - jstests/core/views/views_creation.js
  - jstests/core/views/views_drop.js
  - jstests/core/views/views_rename.js
  - jstests/core_standalone/read_concern.js
  - jstests/core_standalone/write_concern.js
  exclude_with_any_tags:
  - requires_replication
  - requires_sharding
executor:
  archive:
    hooks:
  config:
    shell_options:
      readMode: commands
      eval: load("jstests/libs/override_methods/detect_spawning_own_mongod.js");
  hooks:
  fixture:
    class: MongoDFixture
    mongod_options:
      set_parameters:
        enableTestCommands: 1
